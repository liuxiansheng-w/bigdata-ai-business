# Tableau 工作簿性能优化指南

## 一、视图与URL设置
打开工作簿视图时，在视图URL结尾紧靠会话ID前输入`:record_performance=yes&`，刷新页面后可查看性能选项。

## 二、看板性能最快原则
- **模型设计**：图形数量控制在4个以内（超过4个可能导致性能下降），图形设计尽量简单；
- **仪表板大小**：设置固定大小，避免自动调整；
- **数据源处理**：链接数据源前先做数据汇总，避免使用明细数据；
- **数据提取**：仅提取所需数据（如20秋数据）；
- **筛选器**：减少筛选器数量；
- **计算顺序**：数字和布尔值计算 > 日期计算 > 字符串计算；
- **函数优化**：使用`ELSEIF`替代`ELSE IF`；
- **背景图**：优先使用PNG格式；
- **自定义SQL**：尽量避免使用。

## 三、具体优化方式
### 1. 数据优化
1. **数据提取**：数据表或仪表板均可设置为数据提取；
2. **图表数量**：仪表板放置适量图表（建议≤4个）；
3. **提取筛选**：创建数据提取时，使用筛选器排除不需要的数据（如特定学期数据），并隐藏未使用字段；
4. **预计算**：在“数据”菜单中选择数据源，通过“数据提取”>“立即运算计算”提前存储计算值；
5. **避免自定义SQL**：如需使用，可在数据库创建视图并连接；
6. **筛选器类型**：使用“只保留”筛选器代替“排除”筛选器；
7. **数据子集**：必要时提取样本数据，仅引入分析所需数据；
8. **字段管理**：使用“描述”功能查看字段信息（右键字段-选择“描述”），删除未使用的列；
9. **文件发布**：单独发布工作簿（`.twb`）和数据源，而非打包工作簿（`.twbx`）。

### 2. 筛选优化
1. **快速过滤器**：减少快速过滤器数量，避免选择“仅相关值”（需顺序查询）；
2. **高基数过滤器**：避免使用多选或下拉列表的快速过滤器（加载/渲染慢）；
3. **操作替代**：用仪表板过滤器操作替换“仅相关值”的快速过滤器；
4. **用户过滤器**：避免启用用户过滤器（影响服务器连接共享和查询缓存）；
5. **范围筛选**：简化范围筛选逻辑（复杂范围会拖慢查询）；
6. **上下文筛选**：避免使用快速筛选器或驱动上下文筛选器的操作（需重新加载上下文表）。

### 3. 计算方式优化
1. **计算字段**：谨慎使用，优先数字/布尔值计算（性能优于日期/字符串）；
2. **混合计算**：限制使用（需顺序查询多数据源），必要时合并数据至单表；
3. **行级计算**：避免涉及参数的行级计算（处理时间随参数可能性增加而倍增）。

### 4. 渲染优化
1. **标记数量**：减少视图标记数量（标记越多，渲染越慢）；
2. **图像大小**：图像文件保持在50kb以下，自定义形状使用透明背景PNG（比JPG更高效）；
3. **文本表**：限制使用带大量标记的详细文本表（加载时间长）。

### 5. 自定义SQL优化
1. **实时连接**：限制自定义SQL的实时连接，优先连接数据库视图；
2. **参数使用**：避免在Tableau自定义SQL中使用参数（数据库处理子查询效率低）；
3. **无用子句**：移除`ORDER BY`等无用子句（Tableau会重新排序数据）。

### 6. 本地计算优化
1. **本地计算限制**：即使发布到Tableau Server，仍需限制本地计算（如组、分层结构、表计算等）；
2. **表计算**：表计算依赖本地引擎，可能占用大量内存，需谨慎使用。

### 7. 仪表板布局优化
1. **工作表数量**：仪表板上工作表数量建议≤4个；
2. **固定大小**：根据终端用户使用场景设置固定仪表板大小（优于自动调整）。